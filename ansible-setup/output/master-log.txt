
###############################################
Script name:	ansible-setup.sh
Script user:	brians
Running as:	root
Running on:	wildfly1
IP-Address:	192.168.5.211 192.168.122.1 
###############################################


yum update -y

Loaded plugins: fastestmirror, langpacks
Loading mirror speeds from cached hostfile
 * base: mirror.cisp.com
 * extras: mirror.cisp.com
 * updates: centos.servint.com
No packages marked for update

yum install -y ansible

Loaded plugins: fastestmirror, langpacks
Loading mirror speeds from cached hostfile
 * base: mirror.cisp.com
 * extras: mirror.cisp.com
 * updates: centos.servint.com
Package ansible-2.4.2.0-2.el7.noarch already installed and latest version
Nothing to do

yum install -y  java

Loaded plugins: fastestmirror, langpacks
Loading mirror speeds from cached hostfile
 * base: mirror.cisp.com
 * extras: mirror.cisp.com
 * updates: centos.servint.com
Package 1:java-1.8.0-openjdk-1.8.0.191.b12-0.el7_5.x86_64 already installed and latest version
Nothing to do

yum install -y  ant

Loaded plugins: fastestmirror, langpacks
Loading mirror speeds from cached hostfile
 * base: mirror.cisp.com
 * extras: mirror.cisp.com
 * updates: centos.servint.com
Package ant-1.9.2-9.el7.noarch already installed and latest version
Nothing to do

useradd --shell /bin/bash --home /home/ansible --comment 'User to run Ansible Playbooks' ansible

ansible:ansible | chpasswd

ansible ALL=(ALL:ALL) NOPASSWD: ALL > /etc/sudoers.d/ansible

chmod 0440 /etc/sudoers.d/ansible

mkdir -p /home/ansible/.ssh

chmod 700 /home/ansible/.ssh

ssh-keygen -v -b 2048 -t rsa -f /home/ansible/.ssh/id_rsa -N ''
Generating public/private rsa key pair.
Your identification has been saved in /home/ansible/.ssh/id_rsa.
Your public key has been saved in /home/ansible/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:wjmoIT3QfHd6XKAT5vJpkMGS2S7lc/sbMDgOTGpsgeg root@wildfly1
The key's randomart image is:
+---[RSA 2048]----+
|   =. o .        |
|oo+ += o .       |
|+.+== = . .      |
|o*o.+O.B .       |
|oE*.+o%.S        |
|o. * o.*         |
|  . .  ..        |
|        ..       |
|        ..       |
+----[SHA256]-----+

sed -i s/root/ansible/g /home/ansible/.ssh/id_rsa.pub

chmod 600 /home/ansible/.ssh/id_rsa

cp /home/ansible/.ssh/id_rsa.pub /home/ansible/.ssh/authorized_keys

chmod 640 /home/ansible/.ssh/authorized_keys

ssh-keyscan 192.168.5.211 192.168.122.1  >> /home/ansible/.ssh/known_hosts
ssh-keyscan wildfly1 >> /home/ansible/.ssh/known_hosts

chown -R ansible:ansible /home/ansible/.ssh
